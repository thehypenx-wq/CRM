@model OfficeSuite.Controllers.SearchResultViewModel

@{
    ViewData["Title"] = "Search Results";
}

<div class="mb-5">
    <h2 class="fw-bold text-dark mb-1">Search Results</h2>
    <p class="text-muted">Found matches for "<span class="fw-bold text-primary query-text">@ViewBag.Query</span>"</p>
</div>

<div class="search-results-container">
    <div class="row g-4">
        @if (Model.Todos.Any())
        {
            <div class="col-12">
                <div class="card border-0 shadow-sm rounded-4 overflow-hidden search-section-card">
                    <div class="card-header bg-white border-0 pt-4 px-4 pb-0">
                        <h6 class="text-primary text-uppercase small fw-bold mb-0 d-flex align-items-center">
                            <i data-feather="check-square" class="me-2" style="width: 18px;"></i> Tasks
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            @foreach (var item in Model.Todos)
                            {
                                <a asp-controller="Todo" asp-action="Edit" asp-route-id="@item.Id" class="list-group-item list-group-item-action border-0 px-4 py-3 d-flex justify-content-between align-items-center hover-bg-light">
                                    <div>
                                        <div class="fw-bold text-dark highlightable">@item.Title</div>
                                        <small class="text-muted">Task ID: #@item.Id</small>
                                    </div>
                                    <i data-feather="chevron-right" class="text-muted" style="width: 18px;"></i>
                                </a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }

        @if (Model.Clients.Any())
        {
            <div class="col-12">
                <div class="card border-0 shadow-sm rounded-4 overflow-hidden search-section-card">
                    <div class="card-header bg-white border-0 pt-4 px-4 pb-0">
                        <h6 class="text-success text-uppercase small fw-bold mb-0 d-flex align-items-center">
                            <i data-feather="users" class="me-2" style="width: 18px;"></i> Clients
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            @foreach (var item in Model.Clients)
                            {
                                <a asp-controller="Client" asp-action="Edit" asp-route-id="@item.Id" class="list-group-item list-group-item-action border-0 px-4 py-3 d-flex justify-content-between align-items-center hover-bg-light">
                                    <div>
                                        <div class="fw-bold text-dark highlightable">@item.Name</div>
                                        @if(!string.IsNullOrEmpty(item.CompanyName)) { <small class="text-muted highlightable">@item.CompanyName</small> }
                                    </div>
                                    <i data-feather="chevron-right" class="text-muted" style="width: 18px;"></i>
                                </a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }

        @if (Model.Invoices.Any())
        {
            <div class="col-12">
                <div class="card border-0 shadow-sm rounded-4 overflow-hidden search-section-card">
                    <div class="card-header bg-white border-0 pt-4 px-4 pb-0">
                        <h6 class="text-info text-uppercase small fw-bold mb-0 d-flex align-items-center">
                            <i data-feather="file-text" class="me-2" style="width: 18px;"></i> Invoices / Renewals
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            @foreach (var item in Model.Invoices)
                            {
                                <a asp-controller="Invoice" asp-action="Edit" asp-route-id="@item.Id" class="list-group-item list-group-item-action border-0 px-4 py-3 d-flex justify-content-between align-items-center hover-bg-light">
                                    <div>
                                        <div class="fw-bold text-dark highlightable">@item.Description</div>
                                        <small class="text-muted">Client: <span class="highlightable">@item.ClientName</span></small>
                                    </div>
                                    <i data-feather="chevron-right" class="text-muted" style="width: 18px;"></i>
                                </a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }

        @if (Model.Projects.Any())
        {
            <div class="col-12">
                <div class="card border-0 shadow-sm rounded-4 overflow-hidden search-section-card">
                    <div class="card-header bg-white border-0 pt-4 px-4 pb-0">
                        <h6 class="text-warning text-uppercase small fw-bold mb-0 d-flex align-items-center">
                            <i data-feather="briefcase" class="me-2" style="width: 18px;"></i> Projects
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            @foreach (var item in Model.Projects)
                            {
                                <a asp-controller="Project" asp-action="Edit" asp-route-id="@item.Id" class="list-group-item list-group-item-action border-0 px-4 py-3 d-flex justify-content-between align-items-center hover-bg-light">
                                    <div>
                                        <div class="fw-bold text-dark highlightable">@item.Name</div>
                                        <small class="text-muted">Project ID: #@item.Id</small>
                                    </div>
                                    <i data-feather="chevron-right" class="text-muted" style="width: 18px;"></i>
                                </a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }

        @if (Model.Tickets.Any())
        {
            <div class="col-12">
                <div class="card border-0 shadow-sm rounded-4 overflow-hidden search-section-card">
                    <div class="card-header bg-white border-0 pt-4 px-4 pb-0">
                        <h6 class="text-danger text-uppercase small fw-bold mb-0 d-flex align-items-center">
                            <i data-feather="life-buoy" class="me-2" style="width: 18px;"></i> Tickets
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            @foreach (var item in Model.Tickets)
                            {
                                <a asp-controller="Ticket" asp-action="Details" asp-route-id="@item.Id" class="list-group-item list-group-item-action border-0 px-4 py-3 d-flex justify-content-between align-items-center hover-bg-light">
                                    <div>
                                        <div class="fw-bold text-dark highlightable">@item.Subject</div>
                                        <span class="badge bg-light text-dark border-0 shadow-none px-2 py-1 mt-1">@item.Status</span>
                                    </div>
                                    <i data-feather="chevron-right" class="text-muted" style="width: 18px;"></i>
                                </a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }

        @if (Model.Transactions.Any())
        {
            <div class="col-12">
                <div class="card border-0 shadow-sm rounded-4 overflow-hidden search-section-card">
                    <div class="card-header bg-white border-0 pt-4 px-4 pb-0">
                        <h6 class="text-secondary text-uppercase small fw-bold mb-0 d-flex align-items-center">
                            <i data-feather="dollar-sign" class="me-2" style="width: 18px;"></i> Transactions
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            @foreach (var item in Model.Transactions)
                            {
                                <div class="list-group-item border-0 px-4 py-3 d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="fw-bold text-dark highlightable">@item.Description</div>
                                        <small class="text-muted">@item.Type</small>
                                    </div>
                                    <span class="@(item.Type == "Income" ? "text-success" : "text-danger") fw-bold fs-5">
                                        @(item.Type == "Income" ? "+" : "-") @item.Amount.ToString("C")
                                    </span>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }

        @if (!(Model.Todos.Any() || Model.Clients.Any() || Model.Invoices.Any() || Model.Projects.Any() || Model.Tickets.Any() || Model.Transactions.Any()))
        {
            <div class="col-12 text-center py-5">
                <div class="empty-state-icon mb-4">
                    <i data-feather="search" style="width: 80px; height: 80px;" class="text-muted opacity-25"></i>
                </div>
                <h4 class="fw-bold">No matches found</h4>
                <p class="text-muted mx-auto" style="max-width: 400px;">We couldn't find anything matching "@ViewBag.Query". Try searching for something else or check for typos.</p>
                <a asp-controller="Home" asp-action="Index" class="btn btn-primary rounded-pill px-4 mt-3 shadow-sm">Back to Dashboard</a>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const query = "@ViewBag.Query";
            if (!query) return;

            const highlightElements = document.querySelectorAll('.highlightable');
            const regex = new RegExp(`(${query})`, 'gi');

            highlightElements.forEach(el => {
                const originalText = el.innerText;
                if (regex.test(originalText)) {
                    el.innerHTML = originalText.replace(regex, '<mark class="highlight-mark">$1</mark>');
                }
            });
        });
    </script>
}

<style>
    .search-section-card { transition: transform 0.2s ease, box-shadow 0.2s ease; border: 1px solid rgba(0,0,0,0.03) !important; }
    .search-section-card:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.05) !important; }
    .hover-bg-light:hover { background-color: #f8fafc !important; }
    .highlight-mark { background-color: #fef08a; color: #854d0e; padding: 0.1rem 0.2rem; border-radius: 0.2rem; font-weight: 600; }
    .list-group-item { transition: background-color 0.2s; }
    
    /* Premium accents */
    .search-section-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        opacity: 0.1;
    }
</style>


