@model OfficeSuite.Models.AppEvent

@{
    ViewData["Title"] = "Edit Event";
}

<div class="card card-modern">
    <div class="card-header bg-white border-bottom-0 pt-4 px-4">
        <h4 class="mb-0">Edit Event</h4>
    </div>
    <div class="card-body px-4 pb-4">
        <form asp-action="Edit" method="post" enctype="multipart/form-data">
            <input type="hidden" asp-for="Id" />
            <input type="hidden" asp-for="UserId" />
            
            <div class="row g-3">
                <div class="col-md-12">
                    <label class="form-label text-muted small">Event Title</label>
                    <input asp-for="Title" class="form-control" required />
                </div>
                <div class="col-12">
                    <label class="form-label text-muted small">Description</label>
                    <textarea asp-for="Description" class="form-control" rows="3"></textarea>
                </div>
                <div class="col-md-6">
                    <label class="form-label text-muted small">Start Date & Time</label>
                    <input asp-for="StartDate" type="datetime-local" class="form-control" value="@Model.StartDate.ToString("yyyy-MM-ddTHH:mm")" required />
                </div>
                <div class="col-md-6">
                    <label class="form-label text-muted small">End Date & Time</label>
                    <input asp-for="EndDate" type="datetime-local" class="form-control" value="@Model.EndDate.ToString("yyyy-MM-ddTHH:mm")" required />
                </div>

                <div class="col-md-12 mt-4">
                    <label class="form-label text-muted small">Add Attachments</label>
                    <input type="file" name="attachments" class="form-control" multiple>
                </div>

                @if(Model.Attachments != null && Model.Attachments.Any())
                {
                    <div class="col-12 mt-3">
                        <label class="form-label text-muted small d-block">Existing Attachments</label>
                        <div class="d-flex flex-column gap-2">
                            @foreach(var att in Model.Attachments)
                            {
                                var ext = System.IO.Path.GetExtension(att.FileName).ToLower();
                                var isImage = (ext == ".jpg" || ext == ".png" || ext == ".jpeg" || ext == ".gif" || ext == ".webp");

                                <div class="attachment-card bg-white">
                                    @if(isImage)
                                    {
                                        <div class="attachment-icon p-0 overflow-hidden">
                                            <img src="@att.FilePath" style="width:100%; height:100%; object-fit:cover;" />
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="attachment-icon"><i data-feather="file-text" style="width:16px;"></i></div>
                                    }
                                    <div class="flex-grow-1 text-truncate">
                                        <div class="small fw-bold text-truncate" title="@att.FileName">@att.FileName</div>
                                    </div>
                                    <div class="d-flex gap-1">
                                        <a href="@att.FilePath" target="_blank" class="download-btn text-primary" title="View">
                                            <i data-feather="eye" style="width:14px;"></i>
                                        </a>
                                        <a href="@att.FilePath" download="@att.FileName" class="download-btn" title="Download">
                                            <i data-feather="download" style="width:14px;"></i>
                                        </a>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }

                <div class="col-12 mt-4 text-end">
                    <a asp-action="Index" class="btn btn-light me-2">Cancel</a>
                    <button type="submit" class="btn btn-primary"><i data-feather="save"></i> Save Changes</button>
                </div>
            </div>
        </form>
    </div>
</div>
